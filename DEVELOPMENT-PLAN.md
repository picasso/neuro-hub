# Детальный план разработки NeuroHub MVP

Этот документ содержит пошаговый план разработки платформы NeuroHub согласно функциональной спецификации из MVP.md и архитектурным решениям из ARCHITECTURE-DECISIONS.md.

---

## ЭТАП 0: Инфраструктура и базовая настройка

### 0.1 DevOps и окружение
- [x] Настроить Docker Compose для локальной разработки (PostgreSQL 16, Node 24)
- [x] Создать структуру feature-based модулей в `/app`
- [x] Настроить ESLint 9+ с TypeScript правилами
- [x] Настроить Prettier 3+ для форматирования
- [x] Настроить pre-commit hooks (Husky)
- [x] Создать базовые GitHub Actions workflows для CI/CD
- [ ] Настроить Vercel проект для деплоя
- [ ] Настроить Railway для PostgreSQL в production

### 0.2 База данных
- [x] Настроить Knex.js с TypeScript конфигурацией
- [x] Создать базовую миграционную структуру
- [x] Создать seed файлы для тестовых данных
- [x] Настроить connection pooling
- [x] Настроить GIN-индексы для полнотекстового поиска

### 0.3 Базовая архитектура
- [x] Настроить структуру API Routes `/app/api/*`
- [x] Интегрировать `next-swagger-doc` и `@scalar/nextjs-api-reference`
- [x] Создать базовые Zod схемы для валидации
- [x] Настроить middleware для логирования и rate-limiting
- [x] Создать базовую систему обработки ошибок
- [x] Настроить CORS и CSP заголовки

---

## ЭТАП 1: Аутентификация и пользователи

### 1.1 Better Auth интеграция
- [x] Установить и настроить Better Auth 1+
- [x] Настроить cookie-based сессии
- [x] Реализовать регистрацию с email/паролем
- [x] Реализовать вход в систему
- [x] Настроить OAuth провайдеры (GitHub, Google)
- [x] Реализовать восстановление пароля
- [x] Создать middleware для защиты приватных роутов (через proxy.ts)

### 1.2 База данных пользователей
- [x] Миграция таблицы `users` (создана через Better Auth CLI)
- [x] Миграция таблицы `user_profiles` (уже существует)
- [x] Миграция таблицы `sessions` (создана через Better Auth CLI)
- [x] Миграция таблицы `account` для OAuth и credentials (создана через Better Auth CLI)

### 1.3 Верификация email
- [ ] Миграция таблицы `email_verifications` (token, user_id, expires_at)
- [ ] API endpoint для отправки верификационного письма
- [ ] API endpoint для подтверждения токена
- [ ] Email шаблон для верификации
- [ ] Интеграция email сервиса (резолвить: Resend vs SendGrid)

### 1.4 API endpoints для аутентификации
- [x] `POST /api/auth/sign-up/email` - регистрация (Better Auth)
- [x] `POST /api/auth/sign-in/email` - вход (Better Auth)
- [x] `POST /api/auth/sign-out` - выход (Better Auth)
- [x] `POST /api/auth/forget-password` - восстановление пароля (Better Auth)
- [x] `POST /api/auth/reset-password` - сброс пароля (Better Auth)
- [x] `GET /api/auth/get-session` - получение текущей сессии (Better Auth)
- [ ] `POST /api/auth/verify-email` - верификация email (потом через плагин)

---

## ЭТАП 2: Главная страница и онбординг

### 2.1 Лендинг
- [ ] Создать layout для публичных страниц
- [ ] Реализовать hero-секцию с CTA кнопками
- [ ] Создать раздел с преимуществами платформы
- [ ] Реализовать блок кейсов (карточки проектов)
- [ ] Создать FAQ с аккордеоном
- [ ] Реализовать footer с контактами и соцсетями
- [ ] Добавить мобильную адаптацию
- [ ] SEO мета-теги и Open Graph

### 2.2 Процесс регистрации (wizard)
- [ ] Экран выбора роли (фрилансер/заказчик)
- [ ] Экран базовой информации (email, пароль)
- [ ] Экран заполнения профиля фрилансера (имя, специализация, навыки)
- [ ] Экран заполнения профиля заказчика (имя, компания)
- [ ] Экран подтверждения email
- [ ] Экран персональных рекомендаций
- [ ] Навигация между шагами wizard
- [ ] Прогресс-бар регистрации
- [ ] Валидация на каждом шаге

### 2.3 База данных для онбординга
- [ ] Миграция таблицы `skills` (id, name, category)
- [ ] Миграция таблицы `user_skills` (user_id, skill_id, proficiency_level)
- [ ] Seed данных для предустановленных навыков (GPT-4, Midjourney и т.д.)

---

## ЭТАП 3: Профиль фрилансера

### 3.1 База данных профиля
- [ ] Миграция таблицы `freelancer_profiles` (user_id, hourly_rate, availability, bio, experience)
- [ ] Миграция таблицы `portfolio_items` (id, user_id, title, description, media_url, category, tools_used)
- [ ] Миграция таблицы `huggingface_spaces` (id, user_id, space_url, title, description)
- [ ] Миграция таблицы `reviews` (id, project_id, client_id, freelancer_id, rating, comment)

### 3.2 API endpoints профиля фрилансера
- [ ] `GET /api/freelancers/:id` - получение профиля фрилансера
- [ ] `PUT /api/freelancers/:id` - обновление профиля
- [ ] `GET /api/freelancers/:id/portfolio` - получение портфолио
- [ ] `POST /api/freelancers/:id/portfolio` - добавление работы в портфолио
- [ ] `DELETE /api/freelancers/:id/portfolio/:itemId` - удаление из портфолио
- [ ] `GET /api/freelancers/:id/reviews` - получение отзывов
- [ ] `GET /api/freelancers/:id/stats` - статистика фрилансера
- [ ] `POST /api/freelancers/:id/huggingface` - добавление HF Space
- [ ] `DELETE /api/freelancers/:id/huggingface/:spaceId` - удаление HF Space

### 3.3 UI профиля фрилансера
- [ ] Страница профиля с основной информацией
- [ ] Компонент карточки профиля (для листингов)
- [ ] Секция навыков с тегами и уровнями владения
- [ ] Галерея портфолио (изображения, видео, аудио, тексты)
- [ ] Модальное окно детального просмотра работы из портфолио
- [ ] Встраивание Hugging Face Spaces через iframe
- [ ] Секция отзывов с рейтингом
- [ ] Секция статистики (графики с Effector)
- [ ] Форма редактирования профиля
- [ ] Форма добавления работы в портфолио
- [ ] Форма добавления HF Space

### 3.4 Система рейтинга
- [ ] Расчёт среднего рейтинга
- [ ] Распределение оценок по звёздам
- [ ] Возможность ответа на отзыв

---

## ЭТАП 4: Проекты и поиск для фрилансера

### 4.1 База данных проектов
- [ ] Миграция таблицы `projects` (id, client_id, title, description, category, budget_type, budget_min, budget_max, deadline, status, created_at)
- [ ] Миграция таблицы `project_skills` (project_id, skill_id)
- [ ] Миграция таблицы `project_attachments` (id, project_id, filename, file_url)
- [ ] Миграция таблицы `applications` (id, project_id, freelancer_id, cover_letter, proposed_price, proposed_deadline, status, created_at)

### 4.2 API endpoints проектов
- [ ] `GET /api/projects` - лента проектов с фильтрами
- [ ] `GET /api/projects/:id` - детальная информация о проекте
- [ ] `POST /api/projects` - создание проекта (заказчик)
- [ ] `PUT /api/projects/:id` - обновление проекта
- [ ] `DELETE /api/projects/:id` - удаление проекта
- [ ] `POST /api/projects/:id/applications` - подача заявки (фрилансер)
- [ ] `GET /api/applications` - список заявок фрилансера
- [ ] `DELETE /api/applications/:id` - отзыв заявки

### 4.3 UI поиска проектов
- [ ] Страница ленты проектов
- [ ] Карточка проекта в ленте
- [ ] Фильтры (категория, бюджет, срок, уровень)
- [ ] Сортировка (дата, релевантность, бюджет)
- [ ] Бесконечный скролл с пагинацией
- [ ] Детальная страница проекта
- [ ] Форма подачи заявки
- [ ] Страница истории откликов
- [ ] Шаблоны откликов (сохранение/загрузка)

### 4.4 Умные уведомления
- [ ] Миграция таблицы `notification_preferences` (user_id, email_daily, email_instant, push_enabled)
- [ ] Миграция таблицы `notifications` (id, user_id, type, content, read_at, created_at)
- [ ] API endpoint `POST /api/notifications/preferences` - настройка уведомлений
- [ ] API endpoint `GET /api/notifications` - получение уведомлений
- [ ] API endpoint `PUT /api/notifications/:id/read` - отметка прочитанным
- [ ] Алгоритм подборки релевантных проектов
- [ ] Email digest для уведомлений
- [ ] Push уведомления в браузере
- [ ] Бейдж с количеством непрочитанных

---

## ЭТАП 5: Управление заказами (Kanban)

### 5.1 База данных заказов
- [ ] Миграция таблицы `orders` (id, project_id, freelancer_id, client_id, status, price, started_at, completed_at)
- [ ] Миграция таблицы `order_messages` (id, order_id, sender_id, message, attachments, created_at)
- [ ] Миграция таблицы `order_deliverables` (id, order_id, files, description, submitted_at)
- [ ] Миграция таблицы `order_revisions` (id, order_id, revision_number, feedback, created_at)
- [ ] Миграция таблицы `time_tracking` (id, order_id, started_at, stopped_at, duration_seconds)

### 5.2 API endpoints заказов
- [ ] `GET /api/orders` - список заказов с фильтром по статусу
- [ ] `GET /api/orders/:id` - детальная информация о заказе
- [ ] `PUT /api/orders/:id/status` - обновление статуса заказа
- [ ] `POST /api/orders/:id/messages` - отправка сообщения в чате
- [ ] `GET /api/orders/:id/messages` - получение сообщений
- [ ] `POST /api/orders/:id/deliverables` - сдача работы
- [ ] `POST /api/orders/:id/revisions` - запрос правок
- [ ] `POST /api/orders/:id/complete` - завершение заказа
- [ ] `POST /api/orders/:id/time-tracking` - трекинг времени (старт/стоп)
- [ ] `GET /api/orders/:id/time-tracking` - получение записей времени

### 5.3 UI Kanban доски
- [ ] Компонент Kanban доски с колонками (Входящие, В работе, На проверке, Завершённые)
- [ ] Карточка заказа в Kanban
- [ ] Drag & drop между колонками
- [ ] Детальная страница заказа
- [ ] Встроенный мессенджер с реальным временем
- [ ] Компонент отправки файлов в чате
- [ ] Push уведомления о новых сообщениях
- [ ] Трекер времени (старт/стоп/пауза)
- [ ] Форма сдачи работы
- [ ] Интерфейс просмотра результата работы
- [ ] Форма запроса правок
- [ ] Счётчик оставшихся бесплатных правок
- [ ] Прогресс-бар выполнения заказа

---

## ЭТАП 6: Личный кабинет заказчика

### 6.1 База данных заказчика
- [ ] Миграция таблицы `client_profiles` (user_id, company_name, company_role, typical_tasks)
- [ ] Миграция таблицы `project_templates` (id, client_id, template_name, template_data)
- [ ] Миграция таблицы `invitations` (id, project_id, freelancer_id, message, status, created_at)
- [ ] Миграция таблицы `favorite_freelancers` (client_id, freelancer_id, created_at)

### 6.2 API endpoints заказчика
- [ ] `GET /api/clients/:id` - профиль заказчика
- [ ] `PUT /api/clients/:id` - обновление профиля
- [ ] `GET /api/freelancers` - каталог фрилансеров с фильтрами
- [ ] `POST /api/invitations` - приглашение фрилансера
- [ ] `GET /api/projects/:id/applications` - просмотр откликов на проект
- [ ] `PUT /api/applications/:id/status` - принятие/отклонение заявки
- [ ] `POST /api/favorite-freelancers` - добавление в избранное
- [ ] `GET /api/favorite-freelancers` - список избранных
- [ ] `POST /api/project-templates` - сохранение шаблона проекта
- [ ] `GET /api/project-templates` - список шаблонов

### 6.3 UI создания проекта
- [ ] Wizard создания проекта (многошаговая форма)
- [ ] Шаг 1: Название и категория
- [ ] Шаг 2: Описание и требования (с markdown)
- [ ] Шаг 3: Бюджет (фиксированный/почасовой)
- [ ] Шаг 4: Срок исполнения
- [ ] Шаг 5: Прикрепление файлов ТЗ
- [ ] Превью проекта перед публикацией
- [ ] Сохранение как шаблона
- [ ] Загрузка из шаблона

### 6.4 UI поиска исполнителей
- [ ] Страница каталога фрилансеров
- [ ] Карточка фрилансера в каталоге
- [ ] Фильтры (категория, навыки, рейтинг, цена, доступность)
- [ ] Сортировка (рейтинг, цена, кол-во проектов)
- [ ] Детальная страница профиля фрилансера (view only)
- [ ] Кнопка приглашения в проект
- [ ] Список избранных фрилансеров

### 6.5 UI управления проектами
- [ ] Страница списка проектов заказчика
- [ ] Страница откликов на конкретный проект
- [ ] Сортировка откликов (релевантность, цена, рейтинг, дата)
- [ ] Карточка отклика с информацией о фрилансере
- [ ] Кнопки принятия/отклонения заявки
- [ ] Интерфейс приёма работы
- [ ] Форма оставления отзыва и рейтинга

---

## ЭТАП 7: Интеграции и дополнительные функции

### 7.1 Hugging Face Spaces
- [ ] Валидация URL Hugging Face Space
- [ ] Парсинг информации о Space (название, описание)
- [ ] Компонент встраивания iframe с sandbox атрибутами
- [ ] Обработка ошибок загрузки Space
- [ ] Placeholder для загрузки Space

### 7.2 Загрузка и хранение файлов
- [ ] Выбрать решение для хранения файлов (Cloudflare R2 vs Vercel Blob)
- [ ] API endpoint `POST /api/upload` - загрузка файла
- [ ] Валидация типов и размеров файлов
- [ ] Оптимизация изображений (Next.js Image)
- [ ] Генерация превью для видео
- [ ] CDN интеграция для статики

### 7.3 Полнотекстовый поиск
- [ ] Создать GIN-индексы для PostgreSQL полнотекстового поиска
- [ ] Функция индексации проектов (tsvector)
- [ ] API endpoint `GET /api/search/projects` с полнотекстовым поиском
- [ ] API endpoint `GET /api/search/freelancers` с полнотекстовым поиском
- [ ] UI компонент поиска с автодополнением

### 7.4 Real-time обновления
- [ ] Выбрать подход для real-time (Server-Sent Events vs WebSockets)
- [ ] Реализовать real-time для мессенджера
- [ ] Реализовать real-time для уведомлений
- [ ] Реализовать real-time для статусов заказов

---

## ЭТАП 8: Аналитика и метрики

### 8.1 База данных аналитики
- [ ] Миграция таблицы `analytics_events` (id, user_id, event_type, event_data, created_at)
- [ ] Миграция таблицы `platform_metrics` (date, metric_name, metric_value)

### 8.2 Сбор метрик
- [ ] Трекинг регистраций (конверсия)
- [ ] Трекинг создания проектов
- [ ] Трекинг откликов
- [ ] Трекинг успешных заказов
- [ ] Расчёт DAU/WAU
- [ ] Расчёт времени до первого заказа
- [ ] Интеграция Google Analytics
- [ ] Дашборд метрик для администратора

---

## ЭТАП 9: Тестирование и QA

### 9.1 Unit тесты
- [ ] Тесты для API endpoints (Jest + Supertest)
- [ ] Тесты для бизнес-логики
- [ ] Тесты для валидационных схем Zod
- [ ] Тесты для утилитных функций

### 9.2 Integration тесты
- [ ] Тесты для аутентификации flow
- [ ] Тесты для создания и управления проектами
- [ ] Тесты для системы откликов
- [ ] Тесты для системы заказов

### 9.3 E2E тесты
- [ ] Настроить Playwright для E2E тестов
- [ ] Тесты для регистрации и верификации
- [ ] Тесты для создания проекта
- [ ] Тесты для подачи заявки
- [ ] Тесты для выполнения заказа

### 9.4 Линтинг и форматирование
- [ ] Запуск `npm run lint:ci` перед каждым коммитом
- [ ] Проверка TypeScript типов
- [ ] Prettier форматирование

---

## ЭТАП 10: Деплой и мониторинг

### 10.1 Production деплой
- [ ] Настроить production окружение на Vercel
- [ ] Настроить PostgreSQL на Railway
- [ ] Настроить environment variables
- [ ] Настроить custom domain
- [ ] Настроить SSL сертификаты
- [ ] Настроить Cloudflare CDN

### 10.2 Мониторинг
- [ ] Настроить логирование (Winston или Pino)
- [ ] Настроить мониторинг ошибок (Sentry)
- [ ] Настроить мониторинг производительности (Vercel Analytics)
- [ ] Настроить алерты для критических ошибок
- [ ] Настроить backup БД на Railway

### 10.3 Документация
- [x] Scalar API документация (/api/reference)
- [ ] README с инструкциями по запуску
- [ ] Документация архитектуры
- [ ] Документация для контрибьюторов

---

## Приоритизация задач для MVP

### Критический путь (необходимо для MVP)
1. **Этап 0:** Инфраструктура
2. **Этап 1:** Аутентификация
3. **Этап 2:** Главная страница и онбординг
4. **Этап 3:** Профиль фрилансера (базовый)
5. **Этап 4:** Проекты и поиск
6. **Этап 5:** Управление заказами (базовый Kanban)
7. **Этап 6:** Личный кабинет заказчика
8. **Этап 7.2:** Загрузка файлов
9. **Этап 10.1:** Деплой

### Можно отложить на post-MVP
- **Этап 7.1:** Hugging Face интеграция (уникальная фича, но не критична для запуска)
- **Этап 7.3:** Полнотекстовый поиск (достаточно базовых фильтров)
- **Этап 7.4:** Real-time обновления (можно использовать polling)
- **Этап 8:** Аналитика (базовую можно через Google Analytics)
- **Этап 9.3:** E2E тесты (сначала unit и integration)

### Параллельная разработка
Следующие блоки можно разрабатывать параллельно:
- Frontend UI + Backend API для одной фичи
- Тесты после завершения фичи
- Документация вместе с кодом

---

## Оценка времени

При разработке одним разработчиком full-stack:
- **Этап 0-1:** 2 недели (инфраструктура + аутентификация)
- **Этап 2-3:** 2 недели (лендинг + профиль фрилансера)
- **Этап 4:** 2 недели (проекты и поиск)
- **Этап 5:** 2 недели (Kanban и заказы)
- **Этап 6:** 2 недели (кабинет заказчика)
- **Этап 7.2:** 1 неделя (загрузка файлов)
- **Этап 9-10:** 2 недели (тестирование и деплой)

**Итого:** ~13 недель на MVP критического пути

При команде из 2-3 разработчиков можно сократить до 6-8 недель.

---

## Связанные документы

- [MVP.md](./MVP.md) - Функциональная спецификация
- [ARCHITECTURE-DECISIONS.md](./ARCHITECTURE-DECISIONS.md) - Архитектурные решения
- [BLOCKS.md](./BLOCKS.md) - Основные функциональные блоки
