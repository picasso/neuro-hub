# Архитектурные решения NeuroHub MVP

Дата: 2026-01-18

## Контекст

При анализе MVP.md были выявлены несоответствия между функциональной спецификацией и текущей конфигурацией проекта. Данный документ фиксирует принятые архитектурные решения для MVP версии.

## Принятые решения

### 1. Архитектура: Монолит вместо микросервисов

**Решение:** Использовать монолитную архитектуру на базе Next.js для MVP.

**Обоснование:**
- Быстрая разработка и итерация на начальном этапе
- Упрощённое развёртывание и отладка
- Меньше операционных сложностей
- Feature-based структура кода позволит выделить микросервисы в будущем при необходимости

**Компромисс:** При масштабировании до 50K+ DAU может потребоваться рефакторинг в микросервисы.

### 2. API: RESTful вместо tRPC

**Решение:** Использовать RESTful API Routes с OpenAPI/Swagger документацией.

**Обоснование:**
- Стандартизированный подход, понятный широкой аудитории разработчиков
- Автоматическая документация через Swagger UI
- Возможность интеграции с внешними системами без TypeScript
- Соответствие требованиям MVP.md

**Технологии:**
- `next-swagger-doc` для генерации OpenAPI спецификации
- `swagger-ui-react` для интерактивной документации
- Zod для валидации схем

### 3. База данных: PostgreSQL без Elasticsearch и Redis

**Решение:** Использовать только PostgreSQL 16 для MVP.

**Обоснование:**
- PostgreSQL обеспечивает полнотекстовый поиск через GIN-индексы и tsvector
- Для MVP нагрузка не требует отдельного поискового движка
- Упрощение инфраструктуры и снижение операционных затрат
- Redis может быть добавлен позже для кэширования при необходимости

**Инструменты:**
- Knex.js для query building и миграций
- Connection pooling для оптимизации производительности

### 4. State Management: Effector

**Решение:** Использовать Effector 23+ вместо Redux/Vuex.

**Обоснование:**
- Reactive state manager с отличной TypeScript поддержкой
- Меньше boilerplate кода по сравнению с Redux
- Встроенная поддержка эффектов и событий
- Хорошо интегрируется с React Server Components

### 5. Аутентификация: Better Auth

**Решение:** Better Auth с cookie-based сессиями вместо чистых JWT.

**Обоснование:**
- Встроенная защита от CSRF и timing attacks
- Поддержка OAuth провайдеров (GitHub, Google) из коробки
- Session management с автоматической ротацией
- Более безопасный подход для веб-приложений по сравнению с JWT в localStorage

### 6. UI Framework: Material UI + Emotion

**Решение:** Material UI 7.3+ с Emotion для стилизации.

**Обоснование:**
- Готовые компоненты высокого качества
- Адаптивный дизайн из коробки
- Хорошая документация и community support
- Emotion обеспечивает гибкость стилизации

## Технологический стек MVP

### Frontend
- Next.js 16+ (App Router) + React 19
- TypeScript 5.9+ (strict mode)
- Material UI 7.3+ + Emotion 11+
- Effector 23+ для state management

### Backend
- Node.js 24 LTS
- Next.js API Routes (RESTful)
- PostgreSQL 16 + Knex.js 3+
- Better Auth 1+

### DevOps
- Docker Compose для локальной разработки
- Vercel для хостинга (frontend + API)
- Railway для PostgreSQL
- Cloudflare CDN для статики
- GitHub Actions для CI/CD

## Миграционный путь

При необходимости масштабирования в будущем:

1. **Микросервисы**: Feature-based структура позволяет выделить модули в отдельные сервисы
2. **Кэширование**: Добавить Redis для session storage и rate limiting
3. **Поиск**: Интегрировать Elasticsearch для advanced search capabilities
4. **Очереди**: Добавить BullMQ для фоновых задач (email, notifications)

## Следующие шаги

1. Создать базовую структуру API endpoints
2. Настроить Swagger документацию
3. Реализовать базовые миграции БД
4. Настроить Better Auth
